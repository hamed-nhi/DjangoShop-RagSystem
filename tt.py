import os
from dotenv import load_dotenv

print("--- 🔑 اسکریپت تست کلید API شروع شد ---")

# مرحله ۱: کلید را قبل از خواندن فایل .env بررسی می‌کنیم
# این نشان می‌دهد که آیا کلیدی از قبل در محیط سیستم (ویندوز) وجود دارد یا نه
print("\n[مرحله ۱] بررسی متغیر محیطی از پیش موجود...")
key_before = os.getenv("OPENAI_API_KEY")

if key_before:
    print(f"یک کلید از پیش موجود پیدا شد: {key_before[:20]}...{key_before[-20:]}")
else:
    print("هیچ کلید از پیش موجودی پیدا نشد.")

# مرحله ۲: تلاش برای خواندن فایل .env
print("\n[مرحله ۲] در حال تلاش برای خواندن متغیرها از فایل .env...")
# تابع load_dotenv فایل .env را در همین پوشه پیدا می‌کند
# مهم: این تابع یک متغیر محیطی از پیش موجود را بازنویسی نمی‌کند
load_dotenv()
print("فایل .env پردازش شد.")

# مرحله ۳: کلید را بعد از خواندن فایل .env بررسی می‌کنیم
# این مقداری است که برنامه شما در نهایت استفاده خواهد کرد
print("\n[مرحله ۳] بررسی مقدار نهایی کلید...")
final_key = os.getenv("OPENAI_API_KEY")

if final_key:
    print(f"✅ کلیدی که برنامه پایتون شما استفاده خواهد کرد: {final_key[:8]}...{final_key[-6:]}")
else:
    print("❌ حتی پس از بررسی فایل .env هم هیچ کلیدی پیدا نشد.")

print("\n--- 🏁 اسکریپت تست تمام شد ---")